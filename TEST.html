<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Strategic Owl | Truth. Reliability. Understanding.</title>

  <!-- Open Graph Meta (Facebook, LinkedIn, Discord, etc.) -->
  <meta property="og:title" content="The Strategic Owl | Truth. Reliability. Understanding." />
  <meta property="og:description" content="Measure credibility and uncover truth using the TRU OWL Score ‚Äî a tool for independent thinkers." />
  <meta property="og:image" content="https://thestrategicowl.com/STOInsightQuiz.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:url" content="https://thestrategicowl.com" />
  <meta property="og:type" content="website" />

  <!-- Twitter Card Meta -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="The Strategic Owl | Truth. Reliability. Understanding." />
  <meta name="twitter:description" content="Measure credibility and uncover truth using the TRU OWL Score ‚Äî a tool for independent thinkers." />
  <meta name="twitter:image" content="https://thestrategicowl.com/TSO.png" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />

  <style>
  .tooltip-word::after {
    content: attr(data-definition);
    position: absolute;
    background-color: var(--highlight);
    color: var(--text);
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 0.85rem;
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.2s ease;
    pointer-events: none;
    transform: translateY(-6px);
    z-index: 999;
  }

  .tooltip-word:hover::after,
  .tooltip-word.touch-active::after {
    opacity: 1;
  }

  .tooltip-word {
    position: relative;
  }
  :root {
    --background: #0D1B2A;
    --surface: #112240;
    --highlight: #1A2B4C;
    --truth: #28A745;
    --reliability: #3B6CED;
    --understanding: #D4AF37;
    --text: #FFFFFF;
    --text-muted: #7C8A9B;
    --heading: #FFFFF0;
    --shadow: rgba(0, 0, 0, 0.3);
    --bar-red: #FF4C4C;
    --bar-green: #28A745;
  }

  body {
    background-color: var(--background);
    color: var(--text);
    font-family: 'Inter', sans-serif;
    margin: 0;
    padding: 0;
  }

  /* üß≠ NAVBAR & MENU */
  nav.top-nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 999;
    background-color: var(--highlight);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 20px;
    box-shadow: 0 2px 6px var(--shadow);
  }

  .nav-title {
    font-family: 'Playfair Display', serif;
    font-size: 22px;
    color: var(--understanding);
  }

  .menu-toggle {
    display: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--text);
    background: none;
    border: none;
  }

  .nav-links {
    display: flex;
    gap: 28px;
  }

  .nav-links a {
    color: var(--text-muted);
    text-decoration: none;
    font-size: 15px;
    transition: color 0.3s ease;
  }

  .nav-links a:hover {
    color: var(--understanding);
  }
    .nav-logo img {
  height: 40px;
  width: 40px;
}
    .nav-logo {
  display: flex;
  align-items: center;
  gap: 10px;
  text-decoration: none;
  font-weight: 600;
  color: var(--text);
  font-size: 1.25rem;
}
    /* üé® TRU Bars */
  .divider-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 40px auto;
  }

  .divider-bar {
    display: flex;
    gap: 12px;
    width: 340px;
  }

  .divider-bar div {
    width: 108px;
    height: 6px;
    border-radius: 3px;
    box-shadow: 0 0 4px var(--shadow);
  }

  .truth { background-color: var(--truth); }
  .reliability { background-color: var(--reliability); }
  .understanding { background-color: var(--understanding); }

  .divider-labels {
    display: flex;
    justify-content: center;
    gap: 12px;
    width: 340px;
    margin-top: 8px;
  }

  .divider-labels span {
    width: 108px;
    text-align: center;
    font-size: 0.85rem;
    color: var(--text-muted);
  }

  @media (max-width: 768px) {
  .menu-toggle {
    display: block;
  }

  .nav-links {
    display: none;
    flex-direction: column; /* ‚úÖ stack vertically */
    align-items: center;
    background-color: var(--highlight);
    position: absolute;
    top: 58px;
    left: 0;
    width: 100%;
    padding: 12px 0;
    gap: 12px;
    box-shadow: 0 3px 8px var(--shadow);
  }

  .nav-links.show {
    display: flex;
    animation: fadeSlideDown 0.3s ease;
  }

  .nav-links a {
    padding: 10px 0;
    width: 100%;
    text-align: center;
    font-size: 1rem;
  }

  @keyframes fadeSlideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
}
    #legal-popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(13, 27, 42, 0.95);
  z-index: 9999;
  overflow-y: auto;
  padding: 40px 20px;
  box-sizing: border-box;
  display: none;
}

#legal-popup > div {
  max-width: 680px;
  width: 100%;
  margin: 0 auto;
  background-color: var(--surface);
  padding: 30px;
  border-radius: 8px;
  box-shadow: 0 0 20px var(--shadow);
  font-family: 'Montserrat', sans-serif;
  color: var(--text);
  line-height: 1.6;
}

@media (max-width: 500px) {
  #legal-popup > div {
    padding: 16px 12px;
    font-size: 0.95rem;
  }

  .important-link {
    display: block;
    text-align: center;
    margin-top: 16px;
  }
}

  /* ‚úÖ YOUR ORIGINAL STYLES BELOW */
  .container {
    max-width: 960px;
    margin: 100px auto 0 auto;
    padding: 24px;
  }

  h1 {
    font-family: 'Playfair Display', serif;
    color: var(--heading);
    margin-bottom: 16px;
    text-align: center;
  }
  h2 {
  font-family: 'Playfair Display', serif;
  font-size: 1.5rem;
  color: var(--understanding); /* golden highlight */
  font-weight: 600;
  margin-top: 32px;
  margin-bottom: 12px;
  text-align: center;
}
  p {
  font-family: 'Inter', sans-serif;
  font-size: 1.05rem;
  color: var(--text-muted);
  line-height: 1.6;
  margin-bottom: 20px;
  text-align: center;
  max-width: 700px;
  margin-left: auto;
  margin-right: auto;
}

  select {
    padding: 8px;
    margin-bottom: 16px;
    background-color: var(--surface);
    color: var(--text);
    border: 1px solid var(--highlight);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background-color: var(--surface);
    margin-top: 12px;
  }

  th, td {
    padding: 12px;
    border-bottom: 1px solid var(--highlight);
    text-align: left;
  }

  .text-truth { color: var(--truth); }
  .text-reliability { color: var(--reliability); }
  .text-understanding { color: var(--understanding); }

  .total-score {
    font-weight: bold;
  }

  .positive-score { color: var(--bar-green); }
  .negative-score { color: var(--bar-red); }

  .score-bar {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .bar-indicator {
    width: 10px;
    height: 24px;
    border-radius: 2px;
  }

  .bar-red {
    background-color: var(--bar-red);
  }

  .bar-green {
    background-color: var(--bar-green);
  }
    .match-nav-link {
  color: var(--text-muted);
  text-decoration: none;
  font-size: 15px;
  transition: color 0.3s ease;
}

.match-nav-link:hover {
  color: var(--understanding);
}
 /* Style the link itself */
.important-link {
  color: var(--understanding);               /* Gold color from your theme */
  font-weight: 700;                          /* Bold for visibility */
  text-decoration: underline;                /* Underline to signal it's a link */
  text-underline-offset: 4px;                /* Adds spacing between text and underline */
  position: relative;                        /* Required for pseudo-elements */
  transition: color 0.3s ease, text-shadow 0.3s ease;  /* Smooth hover transitions */
}

/* Add a right-pointing arrow BEFORE the link text */
.important-link::before {
  content: '‚Üí ';                             /* Arrow pointing right */
  display: inline-block;                     /* So we can animate it */
  margin-right: 6px;                         /* Space between arrow and text */
  transition: transform 0.3s ease;           /* Smooth movement on hover */
}

/* Add a left-pointing arrow AFTER the link text */
.important-link::after {
  content: ' ‚Üê';                             /* Arrow pointing left */
  display: inline-block;                     /* Enables transform */
  margin-left: 6px;                          /* Space between text and arrow */
  transition: transform 0.3s ease;           /* Smooth hover animation */
}

/* Animate the left-side arrow to move right on hover */
.important-link:hover::before {
  transform: translateX(4px);                /* Moves ‚Üí arrow to the right */
}

/* Animate the right-side arrow to move left on hover */
.important-link:hover::after {
  transform: translateX(-4px);               /* Moves ‚Üê arrow to the left */
}

/* Add glow and optional color change on hover */
.important-link:hover {
  text-shadow: 0 0 8px var(--understanding); /* Subtle glow using gold tone */
  color: var(--truth);                       /* Optional: changes to green (truth color) */
}
    /* üì¢ Shared Announcement Box Styles */
.announcement-box {
  background-color: var(--surface);
  padding: 24px;
  border-radius: 12px;
  margin: 24px auto;
  max-width: 960px;
  font-family: 'Inter', sans-serif;
  color: var(--text);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  font-size: 1.1rem;
  line-height: 1.7;
  letter-spacing: 0.1px;
  gap: 10px;
}

.announcement-box-mobile {
  background-color: var(--surface);
  padding: 20px 16px;
  border-radius: 12px;
  margin: 24px auto;
  font-family: 'Inter', sans-serif;
  color: var(--text);
  max-width: 90%;
  font-size: 1.05rem;
  line-height: 1.7;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
}

/* üü¢ Label Color */
.announcement-label {
  color: var(--truth);
  font-weight: 600;
  font-size: 1.1rem;
}

/* üîó Strategic Link Styling */
.important-link {
  color: var(--understanding);
  font-weight: 700;
  text-decoration: underline;
  text-underline-offset: 4px;
  position: relative;
  transition: color 0.3s ease, text-shadow 0.3s ease;
}

.important-link::before {
  content: '‚Üí ';
  display: inline-block;
  margin-right: 6px;
  transition: transform 0.3s ease;
}

.important-link::after {
  content: ' ‚Üê';
  display: inline-block;
  margin-left: 6px;
  transition: transform 0.3s ease;
}

.important-link:hover::before {
  transform: translateX(4px);
}

.important-link:hover::after {
  transform: translateX(-4px);
}

.important-link:hover {
  text-shadow: 0 0 8px var(--understanding);
  color: var(--truth);
}

/* üì± Mobile Layout */
@media (max-width: 768px) {
  .announcement-desktop {
    display: none;
  }

  .announcement-mobile {
    padding: 0;
    text-align: center;
  }

  .announcement-box-mobile .important-link {
    display: inline-block;
    margin: 6px 0;
  }
}

/* üíª Desktop Layout */
@media (min-width: 769px) {
  .announcement-mobile {
    display: none;
  }
}
</style>

<nav class="top-nav">
<a href="TRUOWL3.html" class="nav-logo">
  <img src="owl_logo_white.png" alt="Owl Logo" onerror="this.style.display='none';" />
  <div class="nav-title">The Strategic Owl</div>
</a>
  <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
  <div class="nav-links" id="navMenu">
    <a href="#TESThome">Home</a>
    <a href="#dash">Dash's</a>
    <a href="#tru-owl">T.R.U. Owl</a>
    <a href="#insight-quiz">Insight Quiz</a>
    <a href="#realitycheck">Reality Check</a>
    <a href="#TESTthe_constitution">The Constitution</a>
    <a href="#contact">Contact</a>
  </div>
</nav>
  <div class="container">
    <h1>The Strategic Owl</h1>
<!-- üéØ Divider -->
    <section class="divider-section">
      <div class="divider-bar">
        <div class="truth"></div>
        <div class="reliability"></div>
        <div class="understanding"></div>
      </div>
      <div class="divider-labels">
        <span>Truth</span>
        <span>Reliability</span>
        <span>Understanding</span>
      </div>
    </section>
    <div id="main-view">
      <!-- Dynamic partial content will be injected here -->
    </div>
    <!-- Legal Popup -->
<div id="legal-popup">
  <div>
    <h1 style="font-family: 'Playfair Display', serif; color: var(--heading); margin-bottom: 20px;">Well hello there.</h1>

    <p>How do you even know what's real anymore?</p>
    <p>If you've lost trust in the system, you're not wrong. That‚Äôs by design.</p>

    <p style="margin-top: 24px;">Now let me get the legal stuff out of the way.</p>

    <p>
      This site is protected under the <strong>First Amendment</strong> of the United States Constitution.<br>
      All content herein is published for educational and informational purposes.<br>
      It is not intended to defame, mislead, or incite.<br>
      Every claim is supported by public records, sourced materials, or verifiable data ‚Äî and transparency is built into the system to ensure I‚Äôm held to the same standards I use to assess others.
    </p>

    <p style="font-weight: bold; margin-top: 16px;">
      Truth-telling is still legal ‚Äî even if it ruffles a few red hats.
    </p>

    <h2 style="font-family: 'Playfair Display', serif; color: var(--heading); margin-top: 32px;">Join the Watch</h2>

    <p>
      By continuing, you're not just entering a site ‚Äî you're stepping into an experience designed to make you think.<br>
      You're part of a broader mission to restore trust in what‚Äôs real.
    </p>

    <div style="text-align: center; margin-top: 24px;">
      <a href="index.html" id="accept-link" class="important-link">I understand. Let me in.</a>
    </div>

    <p style="margin-top: 12px; font-size: 0.8rem; color: var(--text-muted);">
      This moment will be remembered for 30 days.<br>
      This website uses publicly available data, court records, and verifiable sources. Nothing here is hidden ‚Äî it‚Äôs all in the open.
    </p>
  </div>
</div>
   <!-- Desktop Announcement -->
<div class="announcement-desktop">
  <div class="announcement-box">
    <span class="announcement-label">New Tools Released:</span>
    <span>Try the</span>
    <a href="strategic-owl-insight-quiz.html" class="important-link">Strategic Insight Quiz</a>
    <span>used by left, right, and neither ‚Äî plus explore the</span>
    <a href="#TESTthe_constitution" class="important-link">The Constitution</a>
    <span>as it was meant to be understood.</span>
  </div>
</div>

<!-- Mobile Announcement -->
<div class="announcement-mobile">
  <div class="announcement-box-mobile">
    <div>
      <span class="announcement-label">New Tool Released:</span>
      <span> Try the</span>
    </div>
    <a href="strategic-owl-insight-quiz.html" class="important-link">Strategic Insight Quiz</a>
    <div>used by left, right, and neither ‚Äî plus explore the</div>
    <a href="#TESTthe_constitution" class="important-link">The Constitution</a>
    <div>as it was meant to be understood.</div>
  </div>
</div>
<script>
  const legalPopup = document.getElementById('legal-popup');
  const lastAccepted = localStorage.getItem('legalPopupAccepted');
  const now = new Date().getTime();
  const thirtyDays = 1000 * 60 * 60 * 24 * 30;

  if (!lastAccepted || now - parseInt(lastAccepted) > thirtyDays) {
    legalPopup.style.display = 'block';
  }

  document.getElementById('accept-link').addEventListener('click', () => {
    localStorage.setItem('legalPopupAccepted', Date.now().toString());
  });
  function toggleMenu() {
    document.getElementById("navMenu").classList.toggle("show");
  }
</script>
<script>
  const routes = {
    TESThome: `
      <div>
        <h2>Welcome to the Strategic Owl</h2>
        <p>This is the TESThome content ‚Äî loaded inline without fetch.</p>
      </div>
    `,
    realitycheck: `
      <div class="container">
        <h1>Reality Check</h1>
        <p>
          This is your Misconception Hub ‚Äî where we expose popular myths and break them down with verifiable facts, starting with voter fraud and expanding from there.
        </p>
        <section class="divider-section">
          <div class="divider-bar">
            <div class="truth"></div>
            <div class="reliability"></div>
            <div class="understanding"></div>
          </div>
          <div class="divider-labels">
            <span>Truth</span>
            <span>Reliability</span>
            <span>Understanding</span>
          </div>
        </section>
        <div id="culture-subs">
          <h1>Misconception Hub</h1>
          <p style="text-align: center; color: var(--text-muted); margin-top: 20px;">
            Select a topic to examine popular claims and compare them to verifiable facts ‚Äî one layer at a time.
          </p>
          <div class="dropdown-container">
            <select id="culture-select" class="form-select" onchange="showCultureSubs()">
              <option value="">-- Common Misconception --</option>
            </select>
          </div>
          <div class="table-wrapper" style="display:none;" id="culture-results">
            <table>
              <tbody id="culture-body"></tbody>
            </table>
          </div>
        </div>
        <section class="divider-section">
          <div class="divider-bar">
            <div class="truth"></div>
            <div class="reliability"></div>
            <div class="understanding"></div>
          </div>
          <div class="divider-labels">
            <span>Truth</span>
            <span>Reliability</span>
            <span>Understanding</span>
          </div>
        </section>
        <div id="voter-fraud-section">
          <h1>Voter Fraud?</h1>
          <p>Look past the headlines. Here‚Äôs the actual data.</p>
          <p>The Heritage Foundation tracks every confirmed case of voter fraud ‚Äî often to suggest it‚Äôs a bigger threat than it is. This tool lets you explore that same data, with the context it‚Äôs missing.</p>
          <label for="state-select" style="display: block; margin-bottom: 8px; font-weight: bold;">Select a State:</label>
          <select id="state-select" style="padding: 6px; font-size: 1rem;">
            <option value="">-- Choose a state --</option>
          </select>
          <p id="state-summary" class="subtext"></p>
          <div class="table-wrapper" style="display:none;" id="state-results">
            <table>
              <thead>
                <tr>
                  <th>Year</th>
                  <th>State</th>
                  <th>Name</th>
                </tr>
              </thead>
              <tbody id="state-data-body"></tbody>
            </table>
          </div>
          <p>Source:</p>
          <p><a href="https://www.heritage.org/voterfraud" class="important-link" target="_blank">Heritage Foundation Voter Fraud Database</a></p>
        </div>
        <section class="divider-section">
          <div class="divider-bar">
            <div class="truth"></div>
            <div class="reliability"></div>
            <div class="understanding"></div>
          </div>
          <div class="divider-labels">
            <span>Truth</span>
            <span>Reliability</span>
            <span>Understanding</span>
          </div>
        </section>
        <div id="tru-score-section">
          <p style="text-align: center; color: var(--text-muted); margin-top: 20px;">
            Select a name below to view their Election Security credibility breakdown.
          </p>
          <div class="dropdown-container">
            <select id="person-select" onchange="showScores()">
              <option value="">-- Choose a name --</option>
            </select>
          </div>
          <div class="table-wrapper">
            <table id="score-table" style="display: none;">
              <thead>
                <tr>
                  <th>Category</th>
                  <th>Score</th>
                  <th>Explanation</th>
                </tr>
              </thead>
              <tbody id="score-body"></tbody>
            </table>
          </div>
        </div>
      </div>
    `,
    TESTthe_constitution: `
      <div>
        <div class="container">
          <h1>The Constitution</h1>
          <section class="divider-section">
            <div class="divider-bar">
              <div class="truth"></div>
              <div class="reliability"></div>
              <div class="understanding"></div>
            </div>
            <div class="divider-labels">
              <span>Truth</span>
              <span>Reliability</span>
              <span>Understanding</span>
            </div>
          </section>

          <div style="display: flex; flex-direction: column; gap: 12px; align-items: center; margin-top: 40px;">
            <p style="color: var(--text-muted); font-family: 'Montserrat', sans-serif; font-size: 1rem; max-width: 600px; text-align: center;">
              Curious what Amendment protects your right? Select a right below to learn which Amendment gives you that right.
            </p>
            <label for="subject-quick" style="color: var(--text); font-family: 'Playfair Display', serif; font-size: 1.2rem;">
              Select a Right
            </label>
            <select id="subject-quick" style="padding: 10px; background-color: var(--surface); color: var(--text); border: 1px solid var(--highlight); font-family: 'Montserrat', sans-serif; font-size: 1rem; width: 100%; max-width: 420px;">
              <option value="">-- Select a Right --</option>
            </select>
            <div id="subject-quick-output" style="margin-top: 4px; font-size: 1.05rem; color: var(--understanding); font-family: 'Montserrat', sans-serif; text-align: center;"></div>
          </div>

          <div style="display: flex; flex-direction: column; gap: 12px; align-items: center; margin-top: 40px;">
            <p style="color: var(--text-muted); font-family: 'Montserrat', sans-serif; font-size: 1rem; max-width: 600px; text-align: center;">
              Want to know exactly what the Constitution and every amendment says? Choose a Founding Text to begin.
            </p>
            <label for="subject-select" style="color: var(--text); font-family: 'Playfair Display', serif; font-size: 1.2rem;">
              Select a Founding Text
            </label>
            <select id="subject-select" style="padding: 10px; background-color: var(--surface); color: var(--text); border: 1px solid var(--highlight); font-family: 'Montserrat', sans-serif; font-size: 1rem;">
              <option value="">-- Select the Founding Text --</option>
            </select>
          </div>

          <div id="insight-output" style="max-width: 960px; margin: 40px auto 0; font-family: 'Montserrat', sans-serif; background-color: var(--surface); color: var(--text); padding: 24px; border-radius: 12px;">
            <!-- Content is inserted here dynamically -->
          </div>
        </div>
      </div>
    `,
    contact: `
      <div>
        <h2>Contact Us</h2>
        <p>Reach us at info@strategicowl.com</p>
      </div>
    `,
    // Add additional pages as needed...
  };

  function loadContent(route) {
    const view = document.getElementById("main-view");
    const html = routes[route] || routes["TESThome"];
    view.innerHTML = html;

    if (route === "TESTthe_constitution") {
      initConstitutionScripts();
    }

    if (route === "realitycheck") {
      initRealityCheckPage();
    }
  }

  function updateRoute() {
    const hash = location.hash.replace('#', '') || 'TESThome';
    loadContent(hash);
  }

  window.addEventListener('hashchange', updateRoute);
  window.addEventListener('DOMContentLoaded', updateRoute);

  // Constitution dropdown behavior
  function initConstitutionScripts() {
    const SHEET_ID = "19wBEj9hEkvIyQcoR5E_mBGVAxTzMnddMxk8nuQLAumA";
    const API_KEY = "AIzaSyCzuh9HBfe0r70r9U35Pe406PPZ-tz6I78";
    const RANGE = "the_constitution!A2:G1000";
    const SUBJECT_LOOKUP_RANGE = "the_constitution!F2:G100";

    const colors = {
      gold: "#D4AF37",
      text: "#FFFFFF",
      bullet: "#7C8A9B",
      heading: "#FFFFF0"
    };

    async function fetchAmendmentData() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
      const res = await fetch(url);
      const json = await res.json();
      return json.values || [];
    }

    async function fetchSubjectMap() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SUBJECT_LOOKUP_RANGE}?key=${API_KEY}`;
      const res = await fetch(url);
      const json = await res.json();
      return json.values || [];
    }

    async function initAmendmentDropdown() {
      const data = await fetchAmendmentData();
      const amendmentSelect = document.getElementById("subject-select");
      const outputDiv = document.getElementById("insight-output");

      const grouped = {};
      const prompts = {};

      data.forEach(([amendment, section, text, insight, prompt]) => {
        if (!grouped[amendment]) grouped[amendment] = [];
        grouped[amendment].push({ section, text, insight });
        prompts[amendment] = prompt;
      });

      Object.keys(grouped).forEach(amendment => {
        const opt = document.createElement("option");
        opt.value = amendment;
        opt.textContent = amendment;
        amendmentSelect.appendChild(opt);
      });

      amendmentSelect.addEventListener("change", () => {
        const selected = amendmentSelect.value;
        outputDiv.innerHTML = "";
        if (!selected || !grouped[selected]) return;

        const sections = grouped[selected];
        const wrapper = document.createElement("div");

        const h2 = document.createElement("h2");
        h2.textContent = selected;
        h2.style.color = colors.heading;
        h2.style.marginBottom = "24px";
        h2.style.textAlign = "center";
        h2.style.fontFamily = "'Playfair Display', serif";
        wrapper.appendChild(h2);

        sections.forEach(({ section, text, insight }, index) => {
          const h3 = document.createElement("h3");
          h3.textContent = `${section}`;
          h3.style.fontFamily = "'Playfair Display', serif";
          h3.style.fontSize = "1.15rem";
          h3.style.fontWeight = "600";
          h3.style.color = "#E5C878";
          h3.style.marginTop = "20px";
          h3.style.marginBottom = "6px";
          h3.style.textAlign = "center";
          wrapper.appendChild(h3);

          const p = document.createElement("p");
          p.textContent = text;
          p.style.fontFamily = "'Montserrat', sans-serif";
          p.style.color = "var(--text-muted)";
          p.style.fontSize = "1.05rem";
          p.style.lineHeight = "1.6";
          p.style.marginBottom = "10px";
          p.style.textAlign = "center";
          wrapper.appendChild(p);

          const insightLabel = document.createElement("p");
          insightLabel.textContent = "Strategic Insight";
          insightLabel.style.color = colors.gold;
          insightLabel.style.fontFamily = "'Inter', sans-serif";
          insightLabel.style.fontSize = "1rem";
          insightLabel.style.marginBottom = "6px";
          insightLabel.style.marginTop = "10px";
          insightLabel.style.textAlign = "center";
          wrapper.appendChild(insightLabel);

          const insightDiv = document.createElement("div");
          insightDiv.textContent = insight;
          insightDiv.style.fontFamily = "'Montserrat', sans-serif";
          insightDiv.style.borderLeft = `4px solid var(--understanding)`;
          insightDiv.style.padding = "10px 16px";
          insightDiv.style.marginBottom = "24px";
          insightDiv.style.backgroundColor = "#1A2B4C";
          insightDiv.style.color = "var(--understanding)";
          insightDiv.style.fontWeight = "500";
          wrapper.appendChild(insightDiv);

          if (index === sections.length - 1 && prompts[selected]) {
            const promptDiv = document.createElement("div");
            promptDiv.style.marginTop = "8px";
            promptDiv.style.marginBottom = "24px";

            const promptLabel = document.createElement("p");
            promptLabel.textContent = "Copy and Paste to explore further.";
            promptLabel.style.color = colors.gold;
            promptLabel.style.fontFamily = "'Inter', sans-serif";
            promptLabel.style.fontSize = "1rem";
            promptLabel.style.marginBottom = "6px";
            promptLabel.style.textAlign = "center";
            promptDiv.appendChild(promptLabel);

            const promptBox = document.createElement("textarea");
            promptBox.value = prompts[selected];
            promptBox.readOnly = true;
            promptBox.style.width = "100%";
            promptBox.style.padding = "12px";
            promptBox.style.backgroundColor = "#1C2B3A";
            promptBox.style.border = "1px solid #D4AF37";
            promptBox.style.borderLeft = "4px solid #D4AF37";
            promptBox.style.borderRadius = "8px";
            promptBox.style.color = "#D4AF37";
            promptBox.style.fontFamily = "'Courier New', monospace";
            promptBox.style.fontSize = "0.95rem";
            promptBox.style.lineHeight = "1.5";
            promptBox.style.overflow = "hidden";
            promptBox.style.resize = "none";
            promptBox.style.boxSizing = "border-box";
            promptBox.style.height = "auto";

            setTimeout(() => {
              promptBox.style.height = "auto";
              promptBox.style.height = promptBox.scrollHeight + "px";
            }, 0);

            const copyButton = document.createElement("button");
            copyButton.textContent = "Copy";
            copyButton.style.marginTop = "8px";
            copyButton.style.backgroundColor = "#3C465C";
            copyButton.style.color = "#F0F0F0";
            copyButton.style.padding = "6px 16px";
            copyButton.style.border = "none";
            copyButton.style.borderRadius = "8px";
            copyButton.style.cursor = "pointer";
            copyButton.style.fontFamily = "'Inter', sans-serif";
            copyButton.style.fontSize = "0.95rem";
            copyButton.style.transition = "background-color 0.3s ease, transform 0.2s ease";

            copyButton.onmouseenter = () => {
              copyButton.style.backgroundColor = "#4D5A70";
            };
            copyButton.onmouseleave = () => {
              copyButton.style.backgroundColor = "#3C465C";
            };
            copyButton.onclick = () => {
              promptBox.select();
              document.execCommand("copy");
              copyButton.textContent = "Copied!";
              copyButton.style.transform = "scale(0.97)";
              setTimeout(() => {
                copyButton.textContent = "Copy";
                copyButton.style.transform = "scale(1)";
              }, 1500);
            };

            promptDiv.appendChild(promptBox);
            promptDiv.appendChild(copyButton);
            wrapper.appendChild(promptDiv);
          }
        });

        outputDiv.appendChild(wrapper);
      });
    }

    async function initSubjectLookupDropdown() {
      const data = await fetchSubjectMap();
      const dropdown = document.getElementById("subject-quick");
      const output = document.getElementById("subject-quick-output");

      const subjectToAmendment = {};
      data.forEach(([subject, amendment]) => {
        subjectToAmendment[subject] = amendment;
        const opt = document.createElement("option");
        opt.value = subject;
        opt.textContent = subject;
        dropdown.appendChild(opt);
      });

      dropdown.addEventListener("change", () => {
        const selected = dropdown.value;
        output.textContent = selected && subjectToAmendment[selected]
          ? `‚Üí Amendment: ${subjectToAmendment[selected]}`
          : "";
      });
    }

    initAmendmentDropdown();
    initSubjectLookupDropdown();
  }
  // --- TRU Election Security Functions ---
  async function fetchTRUData() {
    const API_KEY = "AIzaSyCzuh9HBfe0r70r9U35Pe406PPZ-tz6I78";
    const SHEET_ID = "19wBEj9hEkvIyQcoR5E_mBGVAxTzMnddMxk8nuQLAumA";
    const RANGE = "ElectionTRU!A2:Y1000";
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
    try {
      const res = await fetch(url);
      const json = await res.json();
      return json.values || [];
    } catch (err) {
      console.error("Failed to fetch sheet data", err);
      const select = document.getElementById("person-select");
      if (select) {
        select.innerHTML = '<option value="">Failed to load data. Please try again later.</option>';
      }
      return [];
    }
  }

  function showScores() {
    const select = document.getElementById("person-select");
    const table = document.getElementById("score-table");
    const tbody = document.getElementById("score-body");
    const selected = select.value;
    if (!selected || !window.rowMap || !window.rowMap[selected]) {
      table.style.display = "none";
      return;
    }

    const row = window.rowMap[selected];
    tbody.innerHTML = "";
    let total = 0;

    const categories = [
      "Constitutional Knowledge", "Legal Framework", "Federalism",
      "Election Mechanics", "Electoral Count Process", "Disinformation Awareness",
      "Public Impact", "Judicial Oversight", "Election Worker Protections",
      "Psychological Manipulation"
    ];

    for (let i = 0; i < 10; i++) {
      const label = categories[i];
      const score = parseInt(row[3 + i]) || 0;
      const explanation = row[14 + i] || "";

      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${label}</td><td>${score >= 0 ? "+" : ""}${score}</td><td>${explanation}</td>`;
      tbody.appendChild(tr);
      total += score;
    }

    const flag = (row[24] || "").toLowerCase();
    let bonus = 0, label = "", desc = "";

    if (flag === "true") {
      bonus = -10;
      label = "2020 Election Denial Penalty";
      desc = "Denial of the 2020 election outcome signals rejection of verified democratic processes and aligns with disinformation or blind loyalty.";
    } else if (flag === "false") {
      bonus = 5;
      label = "2020 Election Affirmation Bonus";
      desc = "Publicly affirming the legitimacy of the 2020 election supports truth, counters disinformation, and helps protect democratic confidence.";
    } else if (flag === "gray") {
      bonus = -5;
      label = "Ambiguous Stance Penalty";
      desc = "Failure to clearly affirm the 2020 election results contributes to public doubt and enables misinformation to spread unchecked.";
    }

    if (label) {
      const bonusClass = bonus >= 0 ? "positive-score" : "negative-score";
      const tr = document.createElement("tr");
      tr.innerHTML = `<td><strong>${label}</strong></td><td class="${bonusClass}"><strong>${bonus >= 0 ? "+" : ""}${bonus}</strong></td><td><strong>${desc}</strong></td>`;
      tbody.appendChild(tr);
      total += bonus;
    }

    const summary = row[13] || "No summary provided.";
    const totalClass = total >= 0 ? "positive-score" : "negative-score";
    const totalRow = document.createElement("tr");
    totalRow.innerHTML = `<td><strong>Total Score</strong></td><td class="${totalClass}"><strong>${total >= 0 ? "+" : ""}${total}</strong></td><td><strong>${summary}</strong></td>`;
    tbody.appendChild(totalRow);

    table.style.display = "table";
  }

  async function initElectionPage() {
    window.rowMap = {};
    const data = await fetchTRUData();
    data.forEach(row => {
      const key = row[0];
      if (key) window.rowMap[key] = row;
    });

    const select = document.getElementById("person-select");
    if (!select) return;

    select.innerHTML = '<option value="">-- Choose a name --</option>';
    Object.keys(window.rowMap).sort().forEach(name => {
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name.replace(/([A-Z])/g, " $1").replace(/^./, s => s.toUpperCase());
      select.appendChild(opt);
    });

    select.removeEventListener("change", showScores);
    select.addEventListener("change", showScores);
  }

  // --- State Fraud Functions ---
  async function fetchSheetData() {
    const API_KEY = "AIzaSyB3NmN4OpDutbaX6V2KkLy1p-vDLghrF5M";
    const SHEET_ID = "1p66gmWWjxJbrySxpR5T--fP8iEgUbW7RrXru61gagRA";
    const RANGE = "HeritageVoterfraudRawData!B6:D1589";
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      return data.values || [];
    } catch (error) {
      console.error("Failed to fetch data:", error);
      return [];
    }
  }

  function populateDropdown(statesSet, stateSelect) {
    const sortedStates = Array.from(statesSet).sort();
    sortedStates.forEach(state => {
      const opt = document.createElement("option");
      opt.value = state;
      opt.textContent = state;
      stateSelect.appendChild(opt);
    });
  }

  async function initStateFraudPage() {
    const stateSelect = document.getElementById("state-select");
    const tableBody = document.getElementById("state-data-body");
    const resultsWrapper = document.getElementById("state-results");
    const summaryLine = document.getElementById("state-summary");

    if (!stateSelect || !tableBody || !resultsWrapper || !summaryLine) {
      console.warn("[statefraud] Required elements not found.");
      return;
    }

    const rows = await fetchSheetData();
    const statesSet = new Set(rows.map(row => row[1]));
    populateDropdown(statesSet, stateSelect);

    stateSelect.addEventListener("change", function () {
      const selected = this.value;
      tableBody.innerHTML = "";
      summaryLine.textContent = "";

      const filtered = rows.filter(row => row[1] === selected);

      if (filtered.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="3">No records found for ${selected}</td></tr>`;
        resultsWrapper.style.display = "flex";
        return;
      }

      const sorted = filtered.sort((a, b) => parseInt(a[0]) - parseInt(b[0]));

      const years = sorted.map(row => parseInt(row[0])).filter(year => !isNaN(year));
      const minYear = Math.min(...years);
      const maxYear = Math.max(...years);
      const caseCount = sorted.length;

      summaryLine.textContent = `${caseCount} case${caseCount === 1 ? '' : 's'} found from ${minYear} to ${maxYear}`;

      sorted.forEach(row => {
        const year = row[0];
        const state = row[1];
        const name = row[2];
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${year}</td><td>${state}</td><td>${name}</td>`;
        tableBody.appendChild(tr);
      });

      resultsWrapper.style.display = "flex";
    });
  }

  // --- Culture Subs Functions ---
  async function fetchCultureData() {
    const SHEET_ID = "19wBEj9hEkvIyQcoR5E_mBGVAxTzMnddMxk8nuQLAumA";
    const RANGE = "CultureSubs!A2:D1000";
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=AIzaSyCzuh9HBfe0r70r9U35Pe406PPZ-tz6I78`;

    try {
      const res = await fetch(url);
      const data = await res.json();
      return data.values || [];
    } catch (error) {
      console.error("Failed to fetch CultureSubs data:", error);
      return [];
    }
  }

  async function initCulturePage() {
    const dropdown = document.getElementById("culture-select");
    const cultureRows = await fetchCultureData();
    const subjectSet = new Set(cultureRows.map(row => row[0]));
    subjectSet.forEach(subject => {
      const opt = document.createElement("option");
      opt.value = subject;
      opt.textContent = subject;
      dropdown.appendChild(opt);
    });

    window.cultureMap = {};
    cultureRows.forEach(row => {
      const subject = row[0];
      if (!window.cultureMap[subject]) {
        window.cultureMap[subject] = [];
      }
      window.cultureMap[subject].push({ subcategory: row[1], claim: row[2], extra: row[3] || "" });
    });
  }

  function showCultureSubs() {
    const selected = document.getElementById("culture-select").value;
    const wrapper = document.getElementById("culture-results");
    const body = document.getElementById("culture-body");
    body.innerHTML = "";

    if (!selected || !window.cultureMap[selected]) {
      wrapper.style.display = "none";
      return;
    }

    window.cultureMap[selected].forEach(({ claim, extra }) => {
      const claimRow = document.createElement("tr");
      claimRow.innerHTML = `<td colspan="3" style="padding-left: 12px; padding-top: 16px; color: #FF7F7F; font-weight: bold;"><em>Claim:</em> ${claim}</td>`;
      body.appendChild(claimRow);

      const factRow = document.createElement("tr");
      factRow.innerHTML = `<td colspan="3" style="padding-left: 20px; padding-bottom: 12px; color: var(--understanding);"><em>Fact:</em> ${extra}</td>`;
      body.appendChild(factRow);
    });

    wrapper.style.display = "block";
  }

  function initRealityCheckPage() {
    setTimeout(() => {
      const hasCulture = document.getElementById("culture-select");
      const hasState = document.getElementById("state-select");
      const hasTRU = document.getElementById("person-select");

      if (hasCulture) initCulturePage();
      if (hasState) initStateFraudPage();
      if (hasTRU) initElectionPage();
    }, 50);
  }
// === Word Tooltips (Definitions) ===
  async function initWordTooltips() {
    const SHEET_ID = "19wBEj9hEkvIyQcoR5E_mBGVAxTzMnddMxk8nuQLAumA";
    const API_KEY = "AIzaSyCzuh9HBfe0r70r9U35Pe406PPZ-tz6I78";
    const RANGE = "TRU_Definitions!A2:B1000";
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      const definitions = data.values || [];

      // Walk all text nodes in the body and replace matches
      const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null, false);
      let node;

      while ((node = walker.nextNode())) {
        let parent = node.parentNode;
        if (!parent || parent.classList.contains("tooltip-word") || parent.tagName === "SCRIPT" || parent.tagName === "STYLE") continue;

        const originalText = node.nodeValue;
        let replaced = false;
        let newHTML = originalText;

        definitions.forEach(([word, definition]) => {
          const regex = new RegExp(`\\b(${word})\\b`, "gi");
          if (regex.test(newHTML)) {
            replaced = true;
            newHTML = newHTML.replace(regex, `<span class="tooltip-word" data-definition="${definition}">$1</span>`);
          }
        });

        if (replaced) {
          const span = document.createElement("span");
          span.innerHTML = newHTML;
          parent.replaceChild(span, node);
        }
      }
    } catch (err) {
      console.error("Error loading definitions", err);
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    initWordTooltips();
  });

  // Touch support for tooltips
  document.addEventListener("click", function (e) {
    if (e.target.classList.contains("tooltip-word")) {
      e.target.classList.toggle("touch-active");
      setTimeout(() => e.target.classList.remove("touch-active"), 3000);
    }
  });
</script>

</body>
</html>
