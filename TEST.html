<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Strategic Owl | Sign in</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <!-- Open Graph Meta (Facebook, LinkedIn, Discord, etc.) -->
  <meta property="og:title" content="The Strategic Owl | Truth. Reliability. Understanding." />
  <meta property="og:description" content="Measure credibility and uncover truth using the TRU OWL Score ‚Äî a tool for independent thinkers." />
  <meta property="og:image" content="https://thestrategicowl.com/STOInsightQuiz.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:url" content="https://thestrategicowl.com" />
  <meta property="og:type" content="website" />

  <!-- Twitter Card Meta -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="The Strategic Owl | Truth. Reliability. Understanding." />
  <meta name="twitter:description" content="Measure credibility and uncover truth using the TRU OWL Score ‚Äî a tool for independent thinkers." />
  <meta name="twitter:image" content="https://thestrategicowl.com/TSO.png" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />

  <style>
  :root {
    --background: #0D1B2A;
    --surface: #112240;
    --highlight: #1A2B4C;
    --truth: #28A745;
    --reliability: #3B6CED;
    --understanding: #D4AF37;
    --text: #FFFFFF;
    --text-muted: #7C8A9B;
    --heading: #FFFFF0;
    --shadow: rgba(0, 0, 0, 0.3);
    --bar-red: #FF4C4C;
    --bar-green: #28A745;
  }

  body {
    background-color: var(--background);
    color: var(--text);
    font-family: 'Inter', sans-serif;
    margin: 0;
    padding: 0;
  }

  /* üß≠ NAVBAR & MENU */
  nav.top-nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 999;
    background-color: var(--highlight);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 20px;
    box-shadow: 0 2px 6px var(--shadow);
    overflow: visible;
  }

  .nav-title {
    font-family: 'Playfair Display', serif;
    font-size: 22px;
    color: var(--understanding);
  }

  .menu-toggle {
    display: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--text);
    background: none;
    border: none;
  }

  .nav-links {
    display: flex;
    gap: 28px;
  }

  .nav-links a {
    color: var(--text-muted);
    text-decoration: none;
    font-size: 15px;
    transition: color 0.3s ease;
  }

  .nav-links a:hover {
    color: var(--understanding);
  }

  .login-link {
    padding: 6px 16px;
    border-radius: 999px;
    border: 1px solid var(--understanding);
    color: var(--understanding);
    font-weight: 600;
  }

  .login-link:hover {
    color: #0B1B2A;
    background-color: var(--understanding);
  }
    .nav-logo img {
  height: 40px;
  width: 40px;
}
    .nav-logo {
  display: flex;
  align-items: center;
  gap: 10px;
  text-decoration: none;
  font-weight: 600;
  color: var(--text);
  font-size: 1.25rem;
}
    /* üé® TRU Bars */
  .divider-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 40px auto;
  }

  .divider-bar {
    display: flex;
    gap: 12px;
    width: 340px;
  }

  .divider-bar div {
    width: 108px;
    height: 6px;
    border-radius: 3px;
    box-shadow: 0 0 4px var(--shadow);
  }

  .truth { background-color: var(--truth); }
  .reliability { background-color: var(--reliability); }
  .understanding { background-color: var(--understanding); }

  .divider-labels {
    display: flex;
    justify-content: center;
    gap: 12px;
    width: 340px;
    margin-top: 8px;
  }

  .divider-labels span {
    width: 108px;
    text-align: center;
    font-size: 0.85rem;
    color: var(--text-muted);
  }

  @media (max-width: 768px) {
  .menu-toggle {
    display: block;
  }

  .nav-links {
    display: none;
    flex-direction: column; /* ‚úÖ stack vertically */
    align-items: center;
    background-color: var(--highlight);
    position: fixed;
    z-index: 1000;
    top: 58px;
    left: 0;
    width: 100%;
    padding: 12px 0;
    gap: 12px;
    box-shadow: 0 3px 8px var(--shadow);
  }

  .nav-links.show {
    display: flex !important; /* ensure it overrides any cascade */
    animation: fadeSlideDown 0.3s ease;
  }

  .nav-links a {
    padding: 10px 0;
    width: 100%;
    text-align: center;
    font-size: 1rem;
  }

  @keyframes fadeSlideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
}
    #legal-popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(13, 27, 42, 0.95);
  z-index: 9999;
  overflow-y: auto;
  padding: 40px 20px;
  box-sizing: border-box;
  display: none;
}

#legal-popup > div {
  max-width: 680px;
  width: 100%;
  margin: 0 auto;
  background-color: var(--surface);
  padding: 30px;
  border-radius: 8px;
  box-shadow: 0 0 20px var(--shadow);
  font-family: 'Montserrat', sans-serif;
  color: var(--text);
  line-height: 1.6;
}

@media (max-width: 500px) {
  #legal-popup > div {
    padding: 16px 12px;
    font-size: 0.95rem;
  }

  .important-link {
    display: block;
    text-align: center;
    margin-top: 16px;
  }
}

  /* ‚úÖ YOUR ORIGINAL STYLES BELOW */
  .container {
    max-width: 960px;
    margin: 100px auto 0 auto;
    padding: 24px;
  }

  .auth-card {
    max-width: 420px;
    margin: 24px auto 0 auto;
    padding: 24px 20px;
    background-color: var(--surface);
    border-radius: 16px;
    box-shadow: 0 10px 40px var(--shadow);
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .auth-subtitle {
    font-size: 0.95rem;
    color: var(--text-muted);
    text-align: center;
    margin-top: -4px;
    margin-bottom: 12px;
  }

  .auth-btn {
    width: 100%;
    padding: 10px 14px;
    border-radius: 999px;
    border: none;
    cursor: pointer;
    font-size: 0.95rem;
    font-family: 'Inter', sans-serif;
  }

  .auth-btn.apple {
    background-color: #111827;
    color: #f9fafb;
  }

  .auth-btn.google {
    background-color: #f9fafb;
    color: #111827;
  }

  .auth-btn.email {
    background-color: #1d4ed8;
    color: #f9fafb;
    margin-top: 6px;
  }

  .auth-divider {
    text-align: center;
    font-size: 0.8rem;
    color: #9ca3af;
    margin: 4px 0;
  }

  .auth-field {
    margin-top: 4px;
    margin-bottom: 6px;
  }

  .auth-field label {
    font-size: 0.8rem;
    display: block;
    margin-bottom: 4px;
    color: var(--text-muted);
  }

  .auth-field input {
    width: 100%;
    padding: 8px 10px;
    border-radius: 8px;
    border: 1px solid #4b5563;
    background: #020617;
    color: #e5e7eb;
    font-size: 0.9rem;
    font-family: 'Inter', sans-serif;
  }

  .auth-message {
    min-height: 18px;
    font-size: 0.8rem;
    text-align: center;
    margin-top: 4px;
  }

  .auth-message.error {
    color: #fecaca;
  }

  .auth-message.success {
    color: #bbf7d0;
  }

  .hidden {
    display: none;
  }

  h1 {
    font-family: 'Playfair Display', serif;
    color: var(--understanding);
    font-size: 2.6rem;
    font-weight: 700;
    margin-bottom: 16px;
    text-align: center;
  }
  h2 {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    color: var(--understanding); /* golden highlight */
    font-weight: 600;
    margin-top: 32px;
    margin-bottom: 12px;
    text-align: center;
  }
  p {
  font-family: 'Inter', sans-serif;
  font-size: 1.05rem;
  color: var(--text-muted);
  line-height: 1.6;
  margin-bottom: 20px;
  text-align: center;
  max-width: 700px;
  margin-left: auto;
  margin-right: auto;
}

  select {
    padding: 8px;
    margin-bottom: 16px;
    background-color: var(--surface);
    color: var(--text);
    border: 1px solid var(--highlight);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background-color: var(--surface);
    margin-top: 12px;
  }

  th, td {
    padding: 12px;
    border-bottom: 1px solid var(--highlight);
    text-align: left;
  }

  .text-truth { color: var(--truth); }
  .text-reliability { color: var(--reliability); }
  .text-understanding { color: var(--understanding); }

  .total-score {
    font-weight: bold;
  }

  .positive-score { color: var(--bar-green); }
  .negative-score { color: var(--bar-red); }

  .score-bar {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .bar-indicator {
    width: 10px;
    height: 24px;
    border-radius: 2px;
  }

  .bar-red {
    background-color: var(--bar-red);
  }

  .bar-green {
    background-color: var(--bar-green);
  }
    .match-nav-link {
  color: var(--text-muted);
  text-decoration: none;
  font-size: 15px;
  transition: color 0.3s ease;
}

.match-nav-link:hover {
  color: var(--understanding);
}
 /* Style the link itself */
.important-link {
  color: var(--understanding);               /* Gold color from your theme */
  font-weight: 700;                          /* Bold for visibility */
  text-decoration: underline;                /* Underline to signal it's a link */
  text-underline-offset: 4px;                /* Adds spacing between text and underline */
  position: relative;                        /* Required for pseudo-elements */
  transition: color 0.3s ease, text-shadow 0.3s ease;  /* Smooth hover transitions */
}

/* Add a right-pointing arrow BEFORE the link text */
.important-link::before {
  content: '‚Üí ';                             /* Arrow pointing right */
  display: inline-block;                     /* So we can animate it */
  margin-right: 6px;                         /* Space between arrow and text */
  transition: transform 0.3s ease;           /* Smooth movement on hover */
}

/* Add a left-pointing arrow AFTER the link text */
.important-link::after {
  content: ' ‚Üê';                             /* Arrow pointing left */
  display: inline-block;                     /* Enables transform */
  margin-left: 6px;                          /* Space between text and arrow */
  transition: transform 0.3s ease;           /* Smooth hover animation */
}

/* Animate the left-side arrow to move right on hover */
.important-link:hover::before {
  transform: translateX(4px);                /* Moves ‚Üí arrow to the right */
}

/* Animate the right-side arrow to move left on hover */
.important-link:hover::after {
  transform: translateX(-4px);               /* Moves ‚Üê arrow to the left */
}

/* Add glow and optional color change on hover */
.important-link:hover {
  text-shadow: 0 0 8px var(--understanding); /* Subtle glow using gold tone */
  color: var(--truth);                       /* Optional: changes to green (truth color) */
}
    /* üì¢ Shared Announcement Box Styles */
.announcement-box {
  background-color: var(--surface);
  padding: 24px;
  border-radius: 12px;
  margin: 24px auto;
  max-width: 960px;
  font-family: 'Inter', sans-serif;
  color: var(--text);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  font-size: 1.1rem;
  line-height: 1.7;
  letter-spacing: 0.1px;
  gap: 10px;
}

.announcement-box-mobile {
  background-color: var(--surface);
  padding: 20px 16px;
  border-radius: 12px;
  margin: 24px auto;
  font-family: 'Inter', sans-serif;
  color: var(--text);
  max-width: 90%;
  font-size: 1.05rem;
  line-height: 1.7;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
}

/* üü¢ Label Color */
.announcement-label {
  color: var(--truth);
  font-weight: 600;
  font-size: 1.1rem;
}

/* üîó Strategic Link Styling */
.important-link {
  color: var(--understanding);
  font-weight: 700;
  text-decoration: underline;
  text-underline-offset: 4px;
  position: relative;
  transition: color 0.3s ease, text-shadow 0.3s ease;
}

.important-link::before {
  content: '‚Üí ';
  display: inline-block;
  margin-right: 6px;
  transition: transform 0.3s ease;
}

.important-link::after {
  content: ' ‚Üê';
  display: inline-block;
  margin-left: 6px;
  transition: transform 0.3s ease;
}

.important-link:hover::before {
  transform: translateX(4px);
}

.important-link:hover::after {
  transform: translateX(-4px);
}

.important-link:hover {
  text-shadow: 0 0 8px var(--understanding);
  color: var(--truth);
}

/* üì± Mobile Layout */
@media (max-width: 768px) {
  .announcement-desktop {
    display: none;
  }

  .announcement-mobile {
    padding: 0;
    text-align: center;
  }

  .announcement-box-mobile .important-link {
    display: inline-block;
    margin: 6px 0;
  }
}

/* üíª Desktop Layout */
@media (min-width: 769px) {
  .announcement-mobile {
    display: none;
  }
}
  /* üìú Footer */
  footer {
    text-align: center;
    padding: 24px 12px;
    font-size: 12px;
    color: #D4AF37;
    text-shadow: 0 0 6px rgba(0, 0, 0, 0.6);
    font-family: 'Inter', sans-serif;
  }
    /* ‚îÄ‚îÄ Voter Dashboard: State Picker (brand-aligned) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
/* ‚îÄ‚îÄ Voter Dashboard: State Picker (brand-aligned) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
/* Center the selected value across browsers */
#state-select {
  display: block;             /* ensures margin centering works */
  width: 100%;
  max-width: 360px;
  margin: 12px auto;
  text-align: center;         /* Safari/iOS */
  text-align-last: center;    /* Chrome/Edge/Firefox */
  appearance: auto;           /* restore native look */
  -webkit-appearance: menulist;
}
#state-select option { text-align: center; }  /* helps Safari/iOS */

/* Output wrapper (hidden by default; JS sets to block) */
.state-output {
  display: none;
  margin-top: 12px;
  width: 100%;
  max-width: 560px;
  margin-left: auto;
  margin-right: auto;
  text-align: center;
}

/* Read-only URL field */
#state-url {
  width: 100%;
  padding: 12px 14px;
  background-color: var(--surface);
  color: var(--text);
  border: 1px solid var(--highlight);
  border-radius: 8px;
  box-shadow: 0 2px 6px var(--shadow);
  font-family: 'Inter', sans-serif;
  font-size: 0.98rem;
  text-align: center;
}
#state-url::selection {
  background: var(--understanding);
  color: #0D1B2A;            /* deep navy for contrast */
}

/* Election date line (from Column C) */
.state-date {
  margin-top: 10px;
  font-family: 'Inter', sans-serif;
  font-size: 0.98rem;
  color: var(--text-muted);
  text-align: center;
}
.state-date .date-label {
  font-weight: 600;
  margin-right: 6px;
}
.state-date .date-value {
  color: var(--understanding);
  font-weight: 700;
}

/* Action row */
.state-actions {
  margin-top: 10px;
  display: flex;
  justify-content: center;
}

/* Branded ‚ÄúOpen link‚Äù button */
#state-open {
  display: inline-block;
  padding: 10px 16px;
  background-color: var(--understanding);
  color: #0D1B2A;
  font-weight: 700;
  text-decoration: none;
  border-radius: 8px;
  box-shadow: 0 2px 6px var(--shadow);
  transition: transform 0.05s ease, box-shadow 0.2s ease, background-color 0.2s ease;
}
#state-open:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 10px var(--shadow);
}
#state-open:active {
  transform: translateY(0);
  box-shadow: 0 2px 6px var(--shadow);
}
    .state-deadline .date-value {
    background: #8B0000;
    color: #fff;
    padding: 2px 6px;
    border-radius: 6px;
    font-weight: 700;
  }
    /* üé® Results card font & color overrides */
#zip-output div {
  font-family: 'Playfair Display', serif;   /* Change overall font */
  color: var(--text);                       /* Base color (white) */
  line-height: 1.5;
}

/* Top header line (ZIP ‚Üí State ‚Üí District) */
#zip-output div > div:first-child {
  font-weight: 700;
  font-size: 1.1rem;
  color: var(--understanding);  /* Gold */
  margin-bottom: 6px;
}

/* Status line (Primary / Registration) */
#zip-output .status-line {
  color: var(--text-muted);     /* Muted gray */
  font-size: 0.9rem;
  margin-bottom: 8px;
}

/* Section titles like ‚ÄúU.S. House Race‚Äù */
#zip-output .section-title {
  font-weight: 600;
  color: var(--truth);          /* Green highlight */
  margin-top: 8px;
}

/* Candidate list items */
#zip-output li {
  margin: 4px 0;
  font-size: 0.95rem;
  color: #ffffff;               /* White text */
}
    /* üîó Style the "Open state election page" link */
#zip-output a {
  display: inline-block;
  margin-top: 6px;
  padding: 8px 14px;
  background-color: var(--understanding); /* Gold background */
  color: #0D1B2A;                         /* Deep navy text */
  font-weight: 700;
  text-decoration: none;
  border-radius: 8px;
  box-shadow: 0 2px 6px var(--shadow);
  transition: transform 0.05s ease, box-shadow 0.2s ease, background-color 0.2s ease;
}

#zip-output a:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 10px var(--shadow);
}

#zip-output a:active {
  transform: translateY(0);
  box-shadow: 0 2px 6px var(--shadow);
}
/* Override: make candidate website links golden text, not buttons */
#zip-output a.candidate-site {
  background: none;
  padding: 0;
  margin-top: 0;
  box-shadow: none;
  border-radius: 0;
  color: var(--understanding);
  font-weight: 700;
  text-decoration: underline;
}
#zip-output a.candidate-site:hover {
  text-shadow: 0 0 6px var(--understanding);
  transform: none;
}
#zip-output a.candidate-site:active {
  transform: none;
  box-shadow: none;
}
    /* Primary date text (gold) */
.primary-date {
  color: var(--understanding);   /* your gold */
  font-weight: 700;
}

/* Registration "Deadline" badge (same style as TRUMP tag) */
.deadline-badge {
  margin-left: 6px;
  padding: 2px 6px;
  border-radius: 8px;
  background: #8B0000;  /* dark red */
  color: #fff;
  font-size: 12px;
  font-weight: 700;
}
  </style>

</head>
<body>
<nav class="top-nav">
  <a href="TRUOWL3.html" class="nav-logo">
    <img src="owl_logo_white.png" alt="Owl Logo" onerror="this.style.display='none';" />
    <div class="nav-title">The Strategic Owl</div>
  </a>
  <button class="menu-toggle" id="menuToggle" aria-controls="mobileMenu" aria-expanded="false" aria-label="Toggle menu">‚ò∞</button>
  <div class="nav-links" id="mobileMenu">
    <a href="Index.html">Home</a>
    <a href="Dash.html">Dash's</a>
    <a href="TRUOWL3.html">T.R.U. Owl</a>
    <a href="voter_dash.html">Voter Dash</a>
    <a href="strategic-owl-insight-quiz.html">Insight Quiz</a>
    <a href="realitycheck.html">Reality Check</a>
    <a href="the_constitution.html">The Constitution</a>
    <a href="newcontact3.html">Contact</a>
    <a href="https://strategicfretboard.com" target="_blank" rel="noopener noreferrer">Strategic Fretboard</a>
    <a href="login.html" class="login-link">Sign in</a>
  </div>
</nav>
  <div class="container">
    <h1>Sign in or create your account</h1>
    <p class="auth-subtitle">
      Use Apple, Google, or email. If you‚Äôre new, we‚Äôll create your account as part of sign in and then help you finish your profile.
    </p>
    <div id="auth-view" class="auth-card">
      <button id="btn-apple" class="auth-btn apple">Continue with Apple</button>
      <button id="btn-google" class="auth-btn google">Continue with Google</button>
      <div class="auth-divider">or</div>
      <div class="auth-field">
        <label for="auth-email">Sign in with email</label>
        <input id="auth-email" type="email" placeholder="you@example.com" />
      </div>
      <button id="btn-email" class="auth-btn email">Send me a sign-in link</button>
      <div id="auth-message" class="auth-message"></div>
    </div>
    <div id="profile-view" class="auth-card hidden">
      <h2 style="margin-top:0; margin-bottom:4px;">Finish your profile</h2>
      <p class="auth-subtitle">
        Choose how you want to appear on Strategic Owl.
      </p>
      <div class="auth-field">
        <label for="profile-handle">@handle (no spaces)</label>
        <input id="profile-handle" type="text" placeholder="OwlLogic" />
      </div>
      <div class="auth-field">
        <label for="profile-name">Display name</label>
        <input id="profile-name" type="text" placeholder="Your name" />
      </div>
      <div class="auth-field">
        <label for="profile-bio">Bio</label>
        <input id="profile-bio" type="text" placeholder="Short description (optional)" />
      </div>
      <button id="btn-save-profile" class="auth-btn email">Save profile</button>
      <div id="profile-message" class="auth-message"></div>
    </div>
  </div>
  <!-- üìú Footer -->
  <footer style="text-align: center; padding: 24px 12px; font-size: 12px; color: #D4AF37; text-shadow: 0 0 6px rgba(0,0,0,0.6);">
    ¬© 2025 The Strategic Owl. All rights reserved. This platform is protected under U.S. copyright and constitutional law. Unauthorized use, duplication, or distortion of content is prohibited. Created by Taylor Irby ‚Äî designed for clarity, built for truth.
  </footer>

<script>
  // --- Mobile menu toggle (restores hamburger functionality) ---
  function toggleMenu() {
    const menu = document.getElementById("mobileMenu");
    const btn  = document.getElementById("menuToggle");
    if (!menu) return;
    const nowShowing = menu.classList.toggle("show");
    if (btn) {
      const expanded = btn.getAttribute("aria-expanded") === "true";
      btn.setAttribute("aria-expanded", String(!expanded));
    }
    try { console.log("toggleMenu: show=", nowShowing); } catch(_) {}
  }

  const menuToggleBtn = document.getElementById("menuToggle");
  if (menuToggleBtn) {
    menuToggleBtn.addEventListener("click", toggleMenu);
  }

  // --- Supabase Auth Setup (Strategic Owl project) ---
  const SUPABASE_URL = "https://gopyzkcmvkbusdnwjlbb.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdvcHl6a2NtdmtidXNkbndqbGJiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExODc5MTAsImV4cCI6MjA2Njc2MzkxMH0.g_c2FGIGDgXi_zCA7_ZaIteVm2S_ZkUkB-CHkdBWxc8";
  
  const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  window.addEventListener("DOMContentLoaded", async () => {
    const authMessageEl = document.getElementById("auth-message");
    const appleBtn = document.getElementById("btn-apple");
    const googleBtn = document.getElementById("btn-google");
    const emailBtn = document.getElementById("btn-email");
    const emailInput = document.getElementById("auth-email");

    const authView = document.getElementById("auth-view");
    const profileView = document.getElementById("profile-view");
    const profileHandle = document.getElementById("profile-handle");
    const profileName = document.getElementById("profile-name");
    const profileBio = document.getElementById("profile-bio");
    const profileBtn = document.getElementById("btn-save-profile");
    const profileMsg = document.getElementById("profile-message");

    const setMessage = (text, type = "error") => {
      if (!authMessageEl) return;
      authMessageEl.textContent = text;
      authMessageEl.classList.remove("error", "success");
      authMessageEl.classList.add(type === "success" ? "success" : "error");
    };

    const showAuth = () => {
      if (authView) authView.classList.remove("hidden");
      if (profileView) profileView.classList.add("hidden");
    };

    const showProfile = () => {
      if (authView) authView.classList.add("hidden");
      if (profileView) profileView.classList.remove("hidden");
    };

    // Check auth state and decide whether to show login or profile completion
    const { data: { user } } = await sb.auth.getUser();

    if (user) {
      try {
        const { data: profile, error: profileError } = await sb
          .from("profiles")
          .select("*")
          .eq("id", user.id)
          .single();

        if (profileError) {
          console.error("Error loading profile:", profileError);
          showAuth();
          setMessage("Unable to load your profile. Please try again.");
        } else if (!profile || !profile.handle) {
          // No handle yet: show profile completion form
          showProfile();
          if (profileName && profile.display_name) {
            profileName.value = profile.display_name;
          }
          if (profileBio && profile.bio) {
            profileBio.value = profile.bio;
          }
        } else {
          // Profile looks complete ‚Üí send user into the main app
          window.location.href = "Index.html"; // change if you want a different landing page
          return;
        }
      } catch (err) {
        console.error("Unexpected profile error:", err);
        showAuth();
        setMessage("Something went wrong. Please try again.");
      }
    } else {
      // Not logged in yet ‚Üí show auth view
      showAuth();
    }

    if (appleBtn) {
      appleBtn.onclick = async () => {
        setMessage("");
        const { error } = await sb.auth.signInWithOAuth({
          provider: "apple",
          options: { redirectTo: window.location.href }
        });
        if (error) setMessage(error.message);
      };
    }

    if (googleBtn) {
      googleBtn.onclick = async () => {
        setMessage("");
        const { error } = await sb.auth.signInWithOAuth({
          provider: "google",
          options: { redirectTo: window.location.href }
        });
        if (error) setMessage(error.message);
      };
    }

    if (emailBtn) {
      emailBtn.onclick = async () => {
        setMessage("");
        if (!emailInput || !emailInput.value.trim()) {
          setMessage("Please enter an email address.");
          return;
        }
        const email = emailInput.value.trim();
        const { error } = await sb.auth.signInWithOtp({
          email,
          options: { emailRedirectTo: window.location.href }
        });
        if (error) {
          setMessage(error.message);
        } else {
          setMessage("Check your email for a sign-in link.", "success");
        }
      };
    }

    if (profileBtn) {
      profileBtn.onclick = async () => {
        if (!profileHandle || !profileName) return;

        const rawHandle = profileHandle.value.trim();
        const displayName = profileName.value.trim();
        const bio = profileBio ? profileBio.value.trim() : null;

        if (!rawHandle) {
          if (profileMsg) {
            profileMsg.textContent = "Please choose a handle.";
            profileMsg.classList.remove("success");
            profileMsg.classList.add("error");
          }
          return;
        }

        const normalizedHandle = rawHandle.replace(/\s+/g, "").toLowerCase();

        const { data: { user } } = await sb.auth.getUser();
        if (!user) {
          if (profileMsg) {
            profileMsg.textContent = "You are not logged in.";
            profileMsg.classList.remove("success");
            profileMsg.classList.add("error");
          }
          return;
        }

        const { error } = await sb
          .from("profiles")
          .update({
            handle: normalizedHandle,
            display_name: displayName || user.email,
            bio: bio,
            updated_at: new Date().toISOString()
          })
          .eq("id", user.id);

        if (error) {
          console.error("Error saving profile:", error);
          if (profileMsg) {
            profileMsg.textContent = error.message;
            profileMsg.classList.remove("success");
            profileMsg.classList.add("error");
          }
        } else {
          if (profileMsg) {
            profileMsg.textContent = "Profile saved ‚Äî redirecting‚Ä¶";
            profileMsg.classList.remove("error");
            profileMsg.classList.add("success");
          }
          setTimeout(() => {
            window.location.href = "Index.html"; // or your main app page
          }, 800);
        }
      };
    }
  });

</script>

</body>
</html>
