<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Virtual Guitar Fretboard</title>
  <style>
    :root {
      --fret-color: #ccc;
      --string-color: #aaa;
      --note-bg: #112240;
      --note-text: #fff;
      --highlight-color: #D4AF37;
    }

    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #0D1B2A;
      color: var(--note-text);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    h1 {
      margin-bottom: 30px;
      font-size: 1.6rem;
      color: var(--highlight-color);
    }

    .fretboard-wrapper {
      overflow-x: auto;
      width: 100%;
      max-width: 100vw;
      display: flex;
      justify-content: center;
    }

    .fretboard {
      display: flex;
      flex-direction: column;
      gap: 2px;
      background: transparent;
    }

    .string-row {
      display: grid;
      grid-template-columns: 60px repeat(24, 42px);
    }

    .string-label {
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      background: #1A2B4C;
      color: var(--highlight-color);
    }

    .note-cell {
      border-left: 1px solid var(--fret-color);
      border-bottom: 2px solid var(--string-color);
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--note-bg);
      color: var(--note-text);
      font-size: 1rem;
      font-weight: bold;
      position: relative;
      white-space: pre-line;
      font-family: 'Courier New', Courier, monospace;
      letter-spacing: 0.5px;
      text-shadow: 1px 1px 2px #000;
    }

    .interval-R {
      background-color: #2e7031; /* dim green */
    }

    .interval-M3, .interval-m3 {
      background-color: #3e4c75; /* dim blue */
    }

    .interval-P5 {
      background-color: #704c2e; /* dim brown/orange */
    }

    .interval-M7, .interval-m7 {
      background-color: #553770; /* dim violet */
    }

    .fret-marker {
      position: absolute;
      bottom: 3px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.75rem;
      color: var(--highlight-color);
    }

    select.tuning-select {
      width: 60px;
      background: #1A2B4C;
      color: white;
      border: none;
      padding: 5px;
      font-weight: bold;
    }

    @media (max-width: 768px) {
      .note-cell {
        width: 36px;
        height: 36px;
        font-size: 0.7rem;
      }
    }

    .fret-numbers {
      display: grid;
      grid-template-columns: 60px repeat(24, 42px);
      margin-bottom: 4px;
      color: var(--highlight-color);
      font-size: 0.75rem;
      font-weight: bold;
      text-align: center;
      font-family: 'Courier New', monospace;
      letter-spacing: 0.5px;
    }

    .fret-numbers span {
      padding: 2px 0;
      border-bottom: 1px solid var(--highlight-color);
      opacity: 0.7;
      color: #888;
    }

    .fret-numbers span:first-child {
      background: transparent;
      border: none;
    }

    .fret-numbers .dot-fret {
      color: var(--highlight-color);
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Virtual Guitar Fretboard</h1>
  <label for="chord-select" style="margin: 12px 0;">
    Select Chord or Scale:
    <select id="chord-select">
      <option value="">-- Select --</option>
      <option value="A-major">A Major</option>
      <option value="A-minor">A Minor</option>
      <option value="C-major">C Major</option>
      <option value="C-minor">C Minor</option>
      <option value="E-major">E Major</option>
      <option value="E-minor">E Minor</option>
      <option value="A-blues">A Blues</option>
      <option value="A-major-scale">A Major Scale</option>
      <option value="A-minor-scale">A Minor Scale</option>
      <option value="C-major-scale">C Major Scale</option>
      <option value="C-minor-scale">C Minor Scale</option>
      <option value="E-major-scale">E Major Scale</option>
      <option value="E-minor-scale">E Minor Scale</option>
    </select>
  </label>
  <label style="margin-bottom: 12px;">
    <input type="checkbox" id="accidental-toggle" />
    Descending Mode (Flats & Reverse Scale)
  </label>
  <div id="step-info" style="margin: 8px 0; font-size: 0.9rem; color: #fff;"></div>
  <div id="scale-steps" style="margin: 4px 0 12px; font-size: 0.85rem; color: #aaa;"></div>
  <div id="scale-sequence" style="margin: 4px 0 12px; font-size: 0.85rem; color: #ddd;"></div>
  <div class="fret-numbers"></div>
  <div class="fretboard-wrapper">
    <div class="fretboard" id="fretboard"></div>
  </div>

  <script>
    const SHARP_NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
    const FLAT_NOTES  = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];
    const standardTuning = ['E', 'B', 'G', 'D', 'A', 'E'];
    const numFrets = 24;

    const CHORD_SCALES = {
      'A-major':  { root: 'A', intervals: [0, 4, 7] },
      'A-minor':  { root: 'A', intervals: [0, 3, 7] },
      'C-major':  { root: 'C', intervals: [0, 4, 7] },
      'C-minor':  { root: 'C', intervals: [0, 3, 7] },
      'E-major':  { root: 'E', intervals: [0, 4, 7] },
      'E-minor':  { root: 'E', intervals: [0, 3, 7] },
      'A-blues':  { root: 'A', intervals: [0, 3, 5, 6, 7, 10] },
      'A-major-scale': { root: 'A', intervals: [0, 2, 4, 5, 7, 9, 11] },
      'A-minor-scale': { root: 'A', intervals: [0, 2, 3, 5, 7, 8, 10] },
      'C-major-scale': { root: 'C', intervals: [0, 2, 4, 5, 7, 9, 11] },
      'C-minor-scale': { root: 'C', intervals: [0, 2, 3, 5, 7, 8, 10] },
      'E-major-scale': { root: 'E', intervals: [0, 2, 4, 5, 7, 9, 11] },
      'E-minor-scale': { root: 'E', intervals: [0, 2, 3, 5, 7, 8, 10] }
    };

    const fretboardEl = document.getElementById("fretboard");

    function createTuningSelect(stringIndex, defaultNote) {
      const useFlats = document.getElementById("accidental-toggle")?.checked;
      const ALL_NOTES = useFlats ? FLAT_NOTES : SHARP_NOTES;

      const select = document.createElement("select");
      select.className = "tuning-select";
      select.dataset.string = stringIndex;

      while (select.firstChild) select.removeChild(select.firstChild);

      ALL_NOTES.forEach(note => {
        const opt = document.createElement("option");
        opt.value = note;
        opt.textContent = note;
        if (note === defaultNote) opt.selected = true;
        select.appendChild(opt);
      });
      select.addEventListener("change", () => {
        standardTuning[stringIndex] = select.value;
        renderFretboard();
      });
      return select;
    }

    function getNoteAt(startNote, fret) {
      const useFlats = document.getElementById("accidental-toggle")?.checked;
      const ALL_NOTES = useFlats ? FLAT_NOTES : SHARP_NOTES;

      const startIndex = ALL_NOTES.indexOf(startNote);
      return ALL_NOTES[(startIndex + fret) % 12];
    }

    function renderFretboard() {
      fretboardEl.innerHTML = "";

      const fretNumContainer = document.querySelector(".fret-numbers");
      fretNumContainer.innerHTML = "";
      fretNumContainer.appendChild(document.createElement("span")); // spacer for tuning column
      for (let fret = 1; fret <= numFrets; fret++) {
        const label = document.createElement("span");
        label.textContent = fret;
        if ([3, 5, 7, 9, 12, 15, 17, 19, 21, 24].includes(fret)) {
          label.classList.add("dot-fret");
        }
        fretNumContainer.appendChild(label);
      }

      const useFlats = document.getElementById("accidental-toggle")?.checked;
      const scaleSelect = document.getElementById("chord-select");
      const selectedScale = scaleSelect?.value;
      const scaleData = CHORD_SCALES[selectedScale];
      const rootNote = scaleData?.root || null;
      const scaleIntervals = scaleData?.intervals || null;

      const stepInfo = document.getElementById("step-info");
      const stepDisplay = document.getElementById("scale-steps");
      if (scaleData && rootNote && scaleIntervals) {
        const ALL_NOTES = useFlats ? FLAT_NOTES : SHARP_NOTES;
        const rootIndex = ALL_NOTES.indexOf(rootNote);
        const intervalNames = {
          0: 'R', 1: 'm2', 2: 'M2', 3: 'm3', 4: 'M3', 5: 'P4',
          6: 'TT', 7: 'P5', 8: 'm6', 9: 'M6', 10: 'm7', 11: 'M7'
        };
        const finalIntervals = scaleIntervals;

        const labeledSteps = finalIntervals.map((interval, idx) => {
          const useDescending = useFlats && interval !== 0;
          const noteIndex = useDescending
            ? (rootIndex - interval + 12) % 12
            : (rootIndex + interval) % 12;
          const note = ALL_NOTES[noteIndex];
          const label = intervalNames[interval];
          const className = `interval-${label}`;
          return `<span class="${className}" style="padding: 2px 6px; margin-right: 4px; border-radius: 4px; display: inline-block;">${note} (${label})</span>`;
        });
        stepInfo.innerHTML = `Notes in ${rootNote} scale: ${labeledSteps.join(" ")}`;
        if (scaleIntervals.length > 1) {
          const steps = scaleIntervals.slice(1).map((val, idx) => val - scaleIntervals[idx]);
          stepDisplay.textContent = `Steps: ${steps.join(" ")}`;
        } else {
          stepDisplay.textContent = "";
        }
        // (Scale sequence display removed)
      } else {
        stepInfo.innerHTML = "";
        document.getElementById("scale-steps").textContent = "";
        // document.getElementById("scale-sequence").textContent = "";
      }

      for (let string = 0; string < 6; string++) {
        const tuning = document.querySelector(`select[data-string='${string}']`);
        const tuningNote = tuning ? tuning.value : standardTuning[string];

        const row = document.createElement("div");
        row.className = "string-row";

        const tuningSelect = createTuningSelect(string, tuningNote);
        row.appendChild(tuningSelect);

        for (let fret = 1; fret <= numFrets; fret++) {
          const cell = document.createElement("div");
          cell.className = "note-cell";
          const note = getNoteAt(tuningNote, fret);
          
          const ALL_NOTES = useFlats ? FLAT_NOTES : SHARP_NOTES;
          const rootIndex = ALL_NOTES.indexOf(rootNote);
          const noteIndex = ALL_NOTES.indexOf(note);
          const semitoneFromRoot = useFlats
            ? (rootIndex - noteIndex + 12) % 12
            : (noteIndex - rootIndex + 12) % 12;

          let showNote = true;
          if (scaleIntervals && rootNote) {
            showNote = scaleIntervals.includes(semitoneFromRoot);
          }

          if (showNote && scaleIntervals && rootNote) {
            const intervalNames = {
              0: 'R', 1: 'm2', 2: 'M2', 3: 'm3', 4: 'M3', 5: 'P4',
              6: 'TT', 7: 'P5', 8: 'm6', 9: 'M6', 10: 'm7', 11: 'M7'
            };
            const intervalName = intervalNames[semitoneFromRoot];
            cell.textContent = `${note}\n${intervalName}`;
            if (intervalName) cell.classList.add(`interval-${intervalName}`);
          } else {
            cell.textContent = showNote ? note : "";
          }

          if ([3, 5, 7, 9, 12, 15, 17, 19, 21, 24].includes(fret)) {
            const dot = document.createElement("div");
            dot.className = "fret-marker";
            dot.textContent = "•";
            cell.appendChild(dot);
          }

          row.appendChild(cell);
        }

        fretboardEl.appendChild(row);
      }
    }

    document.getElementById("accidental-toggle").addEventListener("change", renderFretboard);
    document.getElementById("chord-select").addEventListener("change", renderFretboard);

    renderFretboard();
  </script>
</body>
</html>
